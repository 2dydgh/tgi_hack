<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Game Recommendations</title>

    <style>
      html {
        font-size: 15px;
      }
      img {
        display: block;
        height: 250px;
        width: 250px;
      }
    </style>
  </head>
  <body>
    <h1>Game Recommendations</h1>

    <p>게임 카테고리를 선택하세요:</p>
    <select id="category">
      <option value="rpg">RPG</option>
      <option value="action">Action</option>
      <option value="fps">FPS</option>
    </select>

    <p>플레이 유형을 선택하세요:</p>
    <select id="playtype">
      <option value="singleplayer">Singleplayer</option>
      <option value="multiplayer">Multiplayer</option>
    </select>

    <button id="recommend-button">게임 추천받기</button>
    <div id="recommendations"></div>

    <script type="module" src="/index.ts"></script>
    <script>
      const api_key = '3bad6ce02bbd4c3582a41d972f37338f';
      const base_url = 'https://api.rawg.io/api/';
      const endpoint = 'games';
      const resultsPerPage = 10;

      const recommendationsDiv = document.getElementById('recommendations');
      const recommendButton = document.getElementById('recommend-button');
      const categorySelect = document.getElementById('category');
      const playtypeSelect = document.getElementById('playtype');

      // 이전에 저장한 값이 있는지 확인하고, 있다면 해당 값을 불러옴
      const savedCategory = localStorage.getItem('selectedCategory');
      const savedPlaytype = localStorage.getItem('selectedPlaytype');
      if (savedCategory) {
        categorySelect.value = savedCategory;
      }
      if (savedPlaytype) {
        playtypeSelect.value = savedPlaytype;
      }

      recommendButton.addEventListener('click', () => {
        const category = categorySelect.value;
        const playtype = playtypeSelect.value;

        // 선택한 값을 localStorage에 저장
        localStorage.setItem('selectedCategory', category);
        localStorage.setItem('selectedPlaytype', playtype);

        const selectedTags = [category, playtype];
        fetchRecommendations(selectedTags);
      });

      function fetchRecommendations(tags) {
        const tagsString = tags.join(',');

        fetch(
          `${base_url}${endpoint}?key=${api_key}&tags=${tagsString}&ordering=-recommendations_count&page_size=${resultsPerPage}&metacritic`
        )
          .then((response) => response.json())
          .then((data) => {
            const games = data.results;
            recommendationsDiv.innerHTML = '<h2>Recommended Games:</h2>';
            const list = document.createElement('ul');

            games.forEach((game) => {
              const gameTitle = game.name;
              const gameImage = game.background_image;
              const gameTags = game.tags.map((tag) => tag.name).join(', ');
              const gameMetacritic = game.metacritic;
              const gameRecommendationsCount = game.recommendations_count;

              const listItem = document.createElement('li');
              const imgElement = document.createElement('img');
              imgElement.src = gameImage;
              imgElement.alt = gameTitle;
              listItem.appendChild(imgElement);

              const gameInfo = document.createElement('p');
              gameInfo.innerHTML = `<strong>${gameTitle}</strong><br>Tags: ${gameTags}<br>Metacritic Score: ${gameMetacritic}`;
              listItem.appendChild(gameInfo);

              list.appendChild(listItem);
            });

            recommendationsDiv.appendChild(list);
          })
          .catch((error) => {
            console.error('API 요청 중 오류 발생:', error);
          });
      }
    </script>
  </body>
</html>
